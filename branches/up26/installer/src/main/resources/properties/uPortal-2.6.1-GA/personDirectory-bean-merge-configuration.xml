<?xml version="1.0" encoding="UTF-8"?>

<changes>
    <@ldap.comment@file path="WEB-INF/classes/properties/personDirectory.xml">
        <add-or-replace where="end">
            <xpath>/beans/bean[@id='mergedPersonAttributeDao']/property[@name='personAttributeDaos']/list</xpath>
            <value>
                <ref bean="uPortalLdapAttributeSource-@ldap.name@"/>
            </value>
            <@ldap2.comment@value>
                <ref bean="uPortalLdapAttributeSource-@ldap2.name@"/>
            </value@ldap2.comment@>
            <@ldap3.comment@value>
                <ref bean="uPortalLdapAttributeSource-@ldap3.name@"/>
            </value@ldap3.comment@>
            <@ldap4.comment@value>
                <ref bean="uPortalLdapAttributeSource-@ldap4.name@"/>
            </value@ldap4.comment@>
        </add-or-replace>
        <add-or-replace where="end">
            <xpath>/beans</xpath>
            <value>
    <bean id="uPortalLdapAttributeSource-@ldap.name@" class="org.jasig.portal.services.persondir.support.LdapPersonAttributeDaoImpl">
        <property name="ldapServer">
            <ref bean="ldapServer@ldap.name@"/>
        </property>
        <property name="queryAttributes">
            <list>
                <value>username</value>
            </list>
        </property>
        <property name="query">
            <value>(@ldap.server.uid@={0})</value>
        </property>
        <property name="ldapAttributesToPortalAttributes">
            <map>
                <entry key="@ldap.server.uid@"><value>username</value></entry>
                <entry key="@ldap.server.uid@"><value>user.login.id</value></entry>
                <entry key="@ldap.server.uid@"><value>password</value></entry>
                <entry key="givenName"><value>firstName</value></entry>
                <entry key="sn"><value>lastname</value></entry>
                <entry key="mail"><value>mail</value></entry>
                <entry key="cn"><value>displayName</value></entry>
                <entry key="destinationIndicator"><value>uPortalTemplateUserName</value></entry>
            </map>
        </property>
    </bean>
    <bean id="ldapServer@ldap.name@" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod">
            <value>org.jasig.portal.ldap.LdapServices.getLdapServer</value>
        </property>
        <property name="arguments">
            <list>
                <value>@ldap.name@</value>
            </list>
        </property>
    </bean> 

    <@ldap2.comment@bean id="uPortalLdapAttributeSource-@ldap2.name@" class="org.jasig.portal.services.persondir.support.LdapPersonAttributeDaoImpl">
        <property name="ldapServer">
            <ref bean="ldapServer@ldap2.name@"/>
        </property>
        <property name="queryAttributes">
            <list>
                <value>username</value>
            </list>
        </property>
        <property name="query">
            <value>(@ldap2.server.uid@={0})</value>
        </property>
        <property name="ldapAttributesToPortalAttributes">
            <map>
                <entry key="@ldap2.server.uid@"><value>username</value></entry>
                <entry key="@ldap2.server.uid@"><value>user.login.id</value></entry>
                <entry key="@ldap2.server.uid@"><value>password</value></entry>
                <entry key="givenName"><value>firstName</value></entry>
                <entry key="sn"><value>lastname</value></entry>
                <entry key="mail"><value>mail</value></entry>
                <entry key="cn"><value>displayName</value></entry>
                <entry key="destinationIndicator"><value>uPortalTemplateUserName</value></entry>
            </map>
        </property>
    </bean>
    <bean id="ldapServer@ldap2.name@" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod">
            <value>org.jasig.portal.ldap.LdapServices.getLdapServer</value>
        </property>
        <property name="arguments">
            <list>
                <value>@ldap2.name@</value>
            </list>
        </property>
    </bean@ldap2.comment@> 

    <@ldap3.comment@bean id="uPortalLdapAttributeSource-@ldap3.name@" class="org.jasig.portal.services.persondir.support.LdapPersonAttributeDaoImpl">
        <property name="ldapServer">
            <ref bean="ldapServer@ldap3.name@"/>
        </property>
        <property name="queryAttributes">
            <list>
                <value>username</value>
            </list>
        </property>
        <property name="query">
            <value>(@ldap3.server.uid@={0})</value>
        </property>
        <property name="ldapAttributesToPortalAttributes">
            <map>
                <entry key="@ldap3.server.uid@"><value>username</value></entry>
                <entry key="@ldap3.server.uid@"><value>user.login.id</value></entry>
                <entry key="@ldap3.server.uid@"><value>password</value></entry>
                <entry key="givenName"><value>firstName</value></entry>
                <entry key="sn"><value>lastname</value></entry>
                <entry key="mail"><value>mail</value></entry>
                <entry key="cn"><value>displayName</value></entry>
                <entry key="destinationIndicator"><value>uPortalTemplateUserName</value></entry>
            </map>
        </property>
    </bean>
    <bean id="ldapServer@ldap3.name@" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod">
            <value>org.jasig.portal.ldap.LdapServices.getLdapServer</value>
        </property>
        <property name="arguments">
            <list>
                <value>@ldap3.name@</value>
            </list>
        </property>
    </bean@ldap3.comment@> 

    <@ldap4.comment@bean id="uPortalLdapAttributeSource-@ldap4.name@" class="org.jasig.portal.services.persondir.support.LdapPersonAttributeDaoImpl">
        <property name="ldapServer">
            <ref bean="ldapServer@ldap4.name@"/>
        </property>
        <property name="queryAttributes">
            <list>
                <value>username</value>
            </list>
        </property>
        <property name="query">
            <value>(@ldap4.server.uid@={0})</value>
        </property>
        <property name="ldapAttributesToPortalAttributes">
            <map>
                <entry key="@ldap4.server.uid@"><value>username</value></entry>
                <entry key="@ldap4.server.uid@"><value>user.login.id</value></entry>
                <entry key="@ldap4.server.uid@"><value>password</value></entry>
                <entry key="givenName"><value>firstName</value></entry>
                <entry key="sn"><value>lastname</value></entry>
                <entry key="mail"><value>mail</value></entry>
                <entry key="cn"><value>displayName</value></entry>
                <entry key="destinationIndicator"><value>uPortalTemplateUserName</value></entry>
            </map>
        </property>
    </bean>
    <bean id="ldapServer@ldap4.name@" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod">
            <value>org.jasig.portal.ldap.LdapServices.getLdapServer</value>
        </property>
        <property name="arguments">
            <list>
                <value>@ldap4.name@</value>
            </list>
        </property>
    </bean@ldap4.comment@> 

            </value>
        </add-or-replace>
    </file@ldap.comment@>

    <@ldap.comment@file path="WEB-INF/classes/properties/ToroPersonDirs.xml">
        <add-or-replace where="end">
            <xpath>/PersonDirs</xpath>
            <value>
<PersonDirInfo>

        <driver></driver>
        <url>@ldap.protocol.prefix@://@ldap.server.hostname@:@ldap.server.port@</url>
        <logonid>@ldap.server.managerdn@</logonid>
        <logonpassword>@ldap.server.manager.password@</logonpassword>
        <uidquery>(@ldap.server.uid@={0})</uidquery>
        <searchquery>(~MATCH_ALL_OP~(@ldap.server.uid@={0}~WILDCARD_0~)(givenName={1}~WILDCARD_1~)(sn={2}~WILDCARD_2~)(mail={3}~WILDCARD_3~))</searchquery>
        <searchquery2>(&amp;~SEARCH_QUERY~(|~USER_FILTER~))</searchquery2>
        <unionOperator>|</unionOperator>
        <intersectionOperator>&amp;</intersectionOperator>
        <uidSelect>(@ldap.server.uid@={~ARG~})</uidSelect>
        <wildcard>*</wildcard>
        <trueClause></trueClause>
        <usercontext>@ldap.server.basedn@</usercontext>

        <attributes>
                <attribute>
                        <name>@ldap.server.uid@</name>
                        <alias>username</alias>
                </attribute>
                <attribute>
                        <name>@ldap.server.uid@</name>
                        <alias>user.login.id</alias>
                </attribute>
                <attribute>
                        <name>@ldap.server.uid@</name>
                        <alias>password</alias>
                </attribute>
                <attribute>
                        <name>givenName</name>
                        <alias>firstName</alias>
                </attribute>
                <attribute>
                        <name>sn</name>
                        <alias>lastName</alias>
                </attribute>
                <attribute>
                        <name>mail</name>
                        <alias>mail</alias>
                </attribute>
                <attribute>
                        <name>cn</name>
                        <alias>displayName</alias>
                </attribute>
                <attribute>
                        <name>destinationIndicator</name>
                        <alias>uPortalTemplateUserName</alias>
                </attribute>
        </attributes>
</PersonDirInfo>
<@ldap2.comment@PersonDirInfo>


        <driver></driver>
        <url>@ldap2.protocol.prefix@://@ldap2.server.hostname@:@ldap2.server.port@</url>
        <logonid>@ldap2.server.managerdn@</logonid>
        <logonpassword>@ldap2.server.manager.password@</logonpassword>
        <uidquery>(@ldap2.server.uid@={0})</uidquery>
        <searchquery>(~MATCH_ALL_OP~(@ldap2.server.uid@={0}~WILDCARD_0~)(givenName={1}~WILDCARD_1~)(sn={2}~WILDCARD_2~)(mail={3}~WILDCARD_3~))</searchquery>
        <searchquery2>(&amp;~SEARCH_QUERY~(|~USER_FILTER~))</searchquery2>
        <unionOperator>|</unionOperator>
        <intersectionOperator>&amp;</intersectionOperator>
        <uidSelect>(@ldap2.server.uid@={~ARG~})</uidSelect>
        <wildcard>*</wildcard>
        <trueClause></trueClause>
        <usercontext>@ldap2.server.basedn@</usercontext>

        <attributes>
                <attribute>
                        <name>@ldap2.server.uid@</name>
                        <alias>username</alias>
                </attribute>
                <attribute>
                        <name>@ldap2.server.uid@</name>
                        <alias>user.login.id</alias>
                </attribute>
                <attribute>
                        <name>@ldap2.server.uid@</name>
                        <alias>password</alias>
                </attribute>
                <attribute>
                        <name>givenName</name>
                        <alias>firstName</alias>
                </attribute>
                <attribute>
                        <name>sn</name>
                        <alias>lastName</alias>
                </attribute>
                <attribute>
                        <name>mail</name>
                        <alias>mail</alias>
                </attribute>
                <attribute>
                        <name>cn</name>
                        <alias>displayName</alias>
                </attribute>
                <attribute>
                        <name>destinationIndicator</name>
                        <alias>uPortalTemplateUserName</alias>
                </attribute>
        </attributes>
</PersonDirInfo@ldap2.comment@>
<@ldap3.comment@PersonDirInfo>

        <driver></driver>
        <url>@ldap3.protocol.prefix@://@ldap3.server.hostname@:@ldap3.server.port@</url>
        <logonid>@ldap3.server.managerdn@</logonid>
        <logonpassword>@ldap3.server.manager.password@</logonpassword>
        <uidquery>(@ldap3.server.uid@={0})</uidquery>
        <searchquery>(~MATCH_ALL_OP~(@ldap3.server.uid@={0}~WILDCARD_0~)(givenName={1}~WILDCARD_1~)(sn={2}~WILDCARD_2~)(mail={3}~WILDCARD_3~))</searchquery>
        <searchquery2>(&amp;~SEARCH_QUERY~(|~USER_FILTER~))</searchquery2>
        <unionOperator>|</unionOperator>
        <intersectionOperator>&amp;</intersectionOperator>
        <uidSelect>(@ldap3.server.uid@={~ARG~})</uidSelect>
        <wildcard>*</wildcard>
        <trueClause></trueClause>
        <usercontext>@ldap3.server.basedn@</usercontext>

        <attributes>
                <attribute>
                        <name>@ldap3.server.uid@</name>
                        <alias>username</alias>
                </attribute>
                <attribute>
                        <name>@ldap3.server.uid@</name>
                        <alias>user.login.id</alias>
                </attribute>
                <attribute>
                        <name>@ldap3.server.uid@</name>
                        <alias>password</alias>
                </attribute>
                <attribute>
                        <name>givenName</name>
                        <alias>firstName</alias>
                </attribute>
                <attribute>
                        <name>sn</name>
                        <alias>lastName</alias>
                </attribute>
                <attribute>
                        <name>mail</name>
                        <alias>mail</alias>
                </attribute>
                <attribute>
                        <name>cn</name>
                        <alias>displayName</alias>
                </attribute>
                <attribute>
                        <name>destinationIndicator</name>
                        <alias>uPortalTemplateUserName</alias>
                </attribute>
        </attributes>
</PersonDirInfo@ldap3.comment@>
<@ldap4.comment@PersonDirInfo>

        <driver></driver>
        <url>@ldap4.protocol.prefix@://@ldap4.server.hostname@:@ldap4.server.port@</url>
        <logonid>@ldap4.server.managerdn@</logonid>
        <logonpassword>@ldap4.server.manager.password@</logonpassword>
        <uidquery>(@ldap4.server.uid@={0})</uidquery>
        <searchquery>(~MATCH_ALL_OP~(@ldap4.server.uid@={0}~WILDCARD_0~)(givenName={1}~WILDCARD_1~)(sn={2}~WILDCARD_2~)(mail={3}~WILDCARD_3~))</searchquery>
        <searchquery2>(&amp;~SEARCH_QUERY~(|~USER_FILTER~))</searchquery2>
        <unionOperator>|</unionOperator>
        <intersectionOperator>&amp;</intersectionOperator>
        <uidSelect>(@ldap4.server.uid@={~ARG~})</uidSelect>
        <wildcard>*</wildcard>
        <trueClause></trueClause>
        <usercontext>@ldap4.server.basedn@</usercontext>

        <attributes>
                <attribute>
                        <name>@ldap4.server.uid@</name>
                        <alias>username</alias>
                </attribute>
                <attribute>
                        <name>@ldap4.server.uid@</name>
                        <alias>user.login.id</alias>
                </attribute>
                <attribute>
                        <name>@ldap4.server.uid@</name>
                        <alias>password</alias>
                </attribute>
                <attribute>
                        <name>givenName</name>
                        <alias>firstName</alias>
                </attribute>
                <attribute>
                        <name>sn</name>
                        <alias>lastName</alias>
                </attribute>
                <attribute>
                        <name>mail</name>
                        <alias>mail</alias>
                </attribute>
                <attribute>
                        <name>cn</name>
                        <alias>displayName</alias>
                </attribute>
                <attribute>
                        <name>destinationIndicator</name>
                        <alias>uPortalTemplateUserName</alias>
                </attribute>
        </attributes>
</PersonDirInfo@ldap4.comment@>
            </value>
        </add-or-replace>
    </file@ldap.comment@>
</changes>
